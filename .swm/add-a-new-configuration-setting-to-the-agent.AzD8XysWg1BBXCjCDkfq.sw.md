---
id: AzD8XysWg1BBXCjCDkfq
name: Add a new configuration setting to the Agent âš™
file_version: 1.0.2
app_version: 0.10.4
file_blobs:
  monkey/infection_monkey/config.py: 1fbcb876bb4589c9d2cbb22168b4d8e14f7177cc
  monkey/infection_monkey/monkey.py: a15a06edff7b75a71925398353680ae180cad115
  monkey/monkey_island/cc/services/config_schema/internal.py: bdbae24615730e417ba7421e95358c09e9e2d3a0
---

# Make something configurable

In this unit, you will learn how to add a configuration option to Monkey and how to use it in the Monkey Agent code.

## Why is this important?

Enabling users to configure the Monkey's behaviour gives them a lot more freedom in how they want to use the Monkey and enables more use cases.

## What is "Max victims to find"?

The Monkey has a function which finds "victim" machines on the network for the Monkey to try and exploit. It's called `get_victim_machines`. This function accepts an argument which limits how many machines the Monkey should find.

We want to make that value editable by the user instead of constant in the code.

## Manual testing

1.  After you've performed the required changes, reload the Server and check your value exists in the Internal tab of the config (see image).
    
2.  Set the new value to 1, and run Monkey locally (from source). See that the Monkey only scans one machine.

<br/>

In this step we define the value
<!-- NOTE-swimm-snippet: the lines below link your snippet to Swimm -->
### ðŸ“„ monkey/infection_monkey/config.py
```python
â¬œ 131        exploiter_classes = []
â¬œ 132        system_info_collector_classes = []
â¬œ 133    
ðŸŸ© 134        # how many victims to look for in a single scan iteration
ðŸŸ© 135        victims_max_find = 100
â¬œ 136    
â¬œ 137        # how many victims to exploit before stopping
â¬œ 138        victims_max_exploit = 100
```

<br/>

In this step we use the configuration value
<!-- NOTE-swimm-snippet: the lines below link your snippet to Swimm -->
### ðŸ“„ monkey/infection_monkey/monkey.py
```python
â¬œ 159                    if not self._keep_running or not WormConfiguration.alive:
â¬œ 160                        break
â¬œ 161    
ðŸŸ© 162                    machines = self._network.get_victim_machines(max_find=WormConfiguration.victims_max_find,
ðŸŸ© 163                                                                 stop_callback=ControlClient.check_for_stop)
â¬œ 164                    is_empty = True
â¬œ 165                    for machine in machines:
â¬œ 166                        if ControlClient.check_for_stop():
```

<br/>

Note that we have to **explicitly** state all the fields of the schema in `ðŸ“„ monkey/monkey_island/cc/services/config_schema/internal.py`, where all fields for every configuration value are declared.

Note that we set the default value to `100`[<sup id="Z2qT7Xr">â†“</sup>](#f-Z2qT7Xr) , and this value appears on the UI, next to the given `title`[<sup id="Z2iNzKV">â†“</sup>](#f-Z2iNzKV) .
<!-- NOTE-swimm-snippet: the lines below link your snippet to Swimm -->
### ðŸ“„ monkey/monkey_island/cc/services/config_schema/internal.py
```python
â¬œ 40                 "title": "Monkey",
â¬œ 41                 "type": "object",
â¬œ 42                 "properties": {
ðŸŸ© 43                     "victims_max_find": {
ðŸŸ© 44                         "title": "Max victims to find",
ðŸŸ© 45                         "type": "integer",
ðŸŸ© 46                         "default": 100,
ðŸŸ© 47                         "description": "Determines the maximum number of machines the monkey is allowed to scan"
ðŸŸ© 48                     },
â¬œ 49                     "victims_max_exploit": {
â¬œ 50                         "title": "Max victims to exploit",
â¬œ 51                         "type": "integer",
```

<br/>

*   When changing config schema by adding or deleting keys, you need to update the Blackbox Test configurations as well [here](https://github.com/guardicore/monkey/tree/develop/envs/monkey_zoo/blackbox/island_configs).

<br/>

<!-- THIS IS AN AUTOGENERATED SECTION. DO NOT EDIT THIS SECTION DIRECTLY -->
### Swimm Note

<span id="f-Z2qT7Xr">100</span>[^](#Z2qT7Xr) - "monkey/monkey_island/cc/services/config_schema/internal.py" L46
```python
                    "default": 100,
```

<span id="f-Z2iNzKV">title</span>[^](#Z2iNzKV) - "monkey/monkey_island/cc/services/config_schema/internal.py" L44
```python
                    "title": "Max victims to find",
```

<br/>

This file was generated by Swimm. [Click here to view it in the app](https://app.swimm.io/repos/Z2l0aHViJTNBJTNBYmFja2VuZC1zd2ltbSUzQSUzQXJpY2FyZG9sb3Blemc=/docs/AzD8XysWg1BBXCjCDkfq).